<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>体操スコアシート (男子)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
      /* 男子用テーマカラー */
      body { background-color: #f0f8ff; color: #37474f; }
      h1, h3, h4, .tabs button.active { color: #1565c0; }
      .input-section, .ranking-section { border-color: #90caf9; }
      th { background-color: #e3f2fd; }
      tbody tr:nth-child(even) { background-color: #f0f8ff; }
      .tabs button { border-color: #90caf9; background-color: #e3f2fd; }
      button, input[type="file"]::file-selector-button { background-color: #1976d2; }
      button:hover, input[type="file"]::file-selector-button:hover { background-color: #1565c0; }
      input[type="text"], input[type="number"], select { border-color: #90caf9; }
      .manual-table thead th { background-color: #e3f2fd; }
      .switch-gender-btn { background-color: #ec407a; } /* 女子用に切り替えボタンはピンク */
      .switch-gender-btn:hover { background-color: #d81b60; }
      footer { border-top-color: #90caf9; }
    </style>
</head>
<body>

    <h1>
        <span id="competitionName">体操スコアシート (男子)</span>
        <button type="button" class="switch-gender-btn" onclick="location.href='index.html'">女子用に切り替え</button>
    </h1>
    <div id="connectionStatus" style="display: none; padding: 0.5em 1em; background-color: #fffbe6; border: 1px solid #ffe58f; border-radius: 4px; margin-bottom: 1em;"></div>
    <div class="save-container" style="margin-bottom: 1em;">
        <button id="saveButton" style="display: none;">スプレッドシートに保存</button>
        <span id="saveStatus" style="color: green; font-weight: bold;"></span>
    </div>
    <button type="button" id="printBtn">このページを印刷する</button>
    <div style="margin-top: 1em; padding: 1em; border: 1px solid #b8daff; background-color: #cce5ff; border-radius: 8px;">
        <label for="finalizeToggle">大会を終了する:</label>
        <input type="checkbox" id="finalizeToggle">
        <span id="finalizeStatus" style="font-weight: bold;">進行中</span>
    </div>
    <div class="input-section">
        <h3>データ入力</h3>
        <div style="margin-bottom:1em;">
            <label>大会名: <input type="text" id="competitionNameInput" placeholder="例: ○○大会" style="width: 20em;"></label>
        </div>
        <hr style="margin: 1.5em 0;">
        <div class="csv-upload-area" style="margin-bottom:1em;">
            <label for="csvInput">CSVファイルから一括登録:</label>
            <input type="file" id="csvInput" accept=".csv">
            <button id="csvUploadBtn">CSV読み込み</button>
            <button id="csvHelpBtn" type="button">CSVデータの作り方</button>
        </div>
        <hr style="margin: 1.5em 0;">
        <div id="addPlayerSection" style="margin-bottom:1em;">
            <label>選手を個別に追加:</label>
            <input type="text" id="newPlayerName" placeholder="選手名">
            <select id="newPlayerClass"><option value="C">Cクラス</option><option value="B">Bクラス</option><option value="A">Aクラス</option></select>
            <input type="text" id="newPlayerGroup" placeholder="組 (例: 1組)">
            <button id="addPlayerBtn">選手を追加</button>
        </div>
        <hr style="margin: 1.5em 0;">
        <div style="display:flex; align-items:center; gap:1em;">
            <label>クラス: <select id="inputClassSelect"><option value="C">Cクラス</option><option value="B">Bクラス</option><option value="A">Aクラス</option></select></label>
            <label>組: <select id="inputGroupSelect"></select></label>
            <div class="reorder-switch" style="margin-left: auto;">
                <label for="reorderModeToggle">並び替えモード:</label>
                <input type="checkbox" id="reorderModeToggle">
                <span>OFF</span>
            </div>
        </div>
        <div id="inputPlayersArea" style="margin-top:1em;"></div>
        <button id="inputScoreSubmitBtn" style="margin-top:1em;">点数一括登録</button>
    </div>
    <div class="container">
        <div class="ranking-section">
            <div class="tabs" id="totalRankTabs">
                <button data-class="C" class="active">Cクラス</button><button data-class="B">Bクラス</button><button data-class="A">Aクラス</button>
            </div>
            <div class="table-wrapper">
                <div id="totalRankContent_C" class="tab-content active">
                    <h3>Cクラス 総合得点ランキング</h3>
                    <table id="classC_playersTable"><thead><tr><th>順位</th><th>名前</th><th>組</th><th>合計</th><th>編集</th></tr></thead><tbody></tbody></table>
                </div>
                <div id="totalRankContent_B" class="tab-content">
                    <h3>Bクラス 総合得点ランキング</h3>
                    <table id="classB_playersTable"><thead><tr><th>順位</th><th>名前</th><th>組</th><th>合計</th><th>編集</th></tr></thead><tbody></tbody></table>
                </div>
                <div id="totalRankContent_A" class="tab-content">
                     <h3>Aクラス 総合得点ランキング</h3>
                     <table id="classA_playersTable"><thead><tr><th>順位</th><th>名前</th><th>組</th><th>合計</th><th>編集</th></tr></thead><tbody></tbody></table>
                </div>
            </div>
        </div>
        <div class="ranking-section">
            <div class="tabs" id="eventRankTabs">
                <button data-class="C" class="active">Cクラス</button><button data-class="B">Bクラス</button><button data-class="A">Aクラス</button>
            </div>
            <div class="table-wrapper">
                <div id="eventRankContent_C" class="tab-content active">
                    <h3>Cクラス 種目別ランキング</h3>
                    <div data-event="floor"><h4>Cクラス - 床</h4><table id="eventRankContent_C_floor"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="pommel"><h4>Cクラス - あん馬</h4><table id="eventRankContent_C_pommel"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="rings"><h4>Cクラス - つり輪</h4><table id="eventRankContent_C_rings"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="vault"><h4>Cクラス - 跳馬</h4><table id="eventRankContent_C_vault"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="pbars"><h4>Cクラス - 平行棒</h4><table id="eventRankContent_C_pbars"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="hbar"><h4>Cクラス - 鉄棒</h4><table id="eventRankContent_C_hbar"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                </div>
                <div id="eventRankContent_B" class="tab-content">
                    <h3>Bクラス 種目別ランキング</h3>
                    <div data-event="floor"><h4>Bクラス - 床</h4><table id="eventRankContent_B_floor"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="pommel"><h4>Bクラス - あん馬</h4><table id="eventRankContent_B_pommel"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="rings"><h4>Bクラス - つり輪</h4><table id="eventRankContent_B_rings"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="vault"><h4>Bクラス - 跳馬</h4><table id="eventRankContent_B_vault"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="pbars"><h4>Bクラス - 平行棒</h4><table id="eventRankContent_B_pbars"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="hbar"><h4>Bクラス - 鉄棒</h4><table id="eventRankContent_B_hbar"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                </div>
                <div id="eventRankContent_A" class="tab-content">
                    <h3>Aクラス 種目別ランキング</h3>
                    <div data-event="floor"><h4>Aクラス - 床</h4><table id="eventRankContent_A_floor"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="pommel"><h4>Aクラス - あん馬</h4><table id="eventRankContent_A_pommel"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="rings"><h4>Aクラス - つり輪</h4><table id="eventRankContent_A_rings"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="vault"><h4>Aクラス - 跳馬</h4><table id="eventRankContent_A_vault"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="pbars"><h4>Aクラス - 平行棒</h4><table id="eventRankContent_A_pbars"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="hbar"><h4>Aクラス - 鉄棒</h4><table id="eventRankContent_A_hbar"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Created by KOU</p>
        <div class="viewer-links" style="margin-top: 1em; font-size: 0.9em;">
            <p><strong>保護者用ページ:</strong></p>
            <a href="/viewer" target="_blank">女子用 閲覧ページ</a> | <a href="/viewer_men" target="_blank">男子用 閲覧ページ</a>
        </div>
    </footer>

    <div id="print-container"></div>
    <!-- CSVヘルプモーダル -->
    <div id="csvHelpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeCsvHelpModal">&times;</span>
            <h2>CSVデータの作り方 (男子用)</h2>
            <p>Excelなどの表計算ソフトで、以下の形式で選手データを作成し、「CSV (カンマ区切り)」形式で保存してください。</p>
            <p><strong>注意:</strong> 1行目は必ずヘッダー（項目名）にしてください。プログラムは2行目からデータを読み込みます。</p>
            <table class="manual-table">
                <thead>
                    <tr>
                        <th>A列</th><th>B列</th><th>C列</th><th>D列</th><th>E列</th><th>F列</th><th>G列</th><th>H列</th><th>I列</th><th>J列</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>クラス</td><td>組</td><td>(空欄)</td><td>選手名</td><td>床</td><td>あん馬</td><td>つり輪</td><td>跳馬</td><td>平行棒</td><td>鉄棒</td>
                    </tr>
                    <tr>
                        <td>C</td><td>1組</td><td></td><td>体操 太郎</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
                    </tr>
                    <tr>
                        <td>B</td><td>2組</td><td></td><td>日本 陸</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
                    </tr>
                </tbody>
            </table>
            <h4>ポイント</h4>
            <ul>
                <li><strong>A列 (クラス):</strong> C, B, A のいずれかを入力します。</li>
                <li><strong>B列 (組):</strong> 「1組」「2組」のように入力します。</li>
                <li><strong>C列:</strong> この列は使いませんが、必ず空の列として存在させてください。</li>
                <li><strong>D列 (選手名):</strong> 選手のフルネームを入力します。</li>
                <li><strong>E列〜J列 (得点):</strong> 初期値として 0 を入力しておくと確実です。</li>
            </ul>
            <h4>保存方法</h4>
            <ol>
                <li>Excelのメニューから「ファイル」→「名前を付けて保存」を選択します。</li>
                <li>「ファイルの種類」で「CSV (カンマ区切り) (*.csv)」を選択します。</li>
                <li>「保存」ボタンをクリックします。(警告が表示される場合がありますが、「はい」で進んでください)</li>
            </ol>
        </div>
    </div>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <!-- ドラッグ＆ドロップライブラリ -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="app_men.js"></script>
    <script>
        // 自動保存機能の追加
        let autoSaveTimer = null;
        function scheduleAutoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                const saveButton = document.getElementById('saveButton');
                if (saveButton) saveButton.click();
            }, 3000); // 3秒後に保存
        }
        document.body.addEventListener('input', (e) => { if(e.target.type === 'number' || e.target.id === 'competitionNameInput') scheduleAutoSave(); });
    </script>
</body>
</html>
