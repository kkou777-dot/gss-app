<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>体操スコアシート (女子)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
      /* 女子用テーマカラー */
      body { background-color: #fff8fa; color: #5d4037; }
      h1, h3, h4, .tabs button.active { color: #d81b60; }
      .input-section, .ranking-section { border-color: #f8bbd0; }
      th { background-color: #fce4ec; }
      tbody tr:nth-child(even) { background-color: #fff8fa; }
      .tabs button { border-color: #f8bbd0; background-color: #fce4ec; }
      button, input[type="file"]::file-selector-button { background-color: #ec407a; }
      button:hover, input[type="file"]::file-selector-button:hover { background-color: #d81b60; }
      input[type="text"], input[type="number"], select { border-color: #f8bbd0; }
      .manual-table thead th { background-color: #fce4ec; }
      .switch-gender-btn { background-color: #1976d2; } /* 男子用に切り替えボタンは青 */
      .switch-gender-btn:hover { background-color: #1565c0; }
      footer { border-top-color: #f8bbd0; }
    </style>
</head>
<body>

    <h1>
        <span id="competitionName">体操スコアシート (女子)</span>
        <div style="display: flex; align-items: center; gap: 1em;">
            <a href="/viewer" target="_blank" style="font-size: 0.7em;">保護者ページ(女)</a>
            <a href="/viewer_men" target="_blank" style="font-size: 0.7em;">保護者ページ(男)</a>
            <button type="button" class="switch-gender-btn" onclick="location.href='index_men.html'">男子用に切り替え</button>
        </div>
    </h1>
    <!-- サーバー接続状態の表示エリア -->
    <div id="connectionStatus" style="display: none; padding: 0.5em 1em; background-color: #fffbe6; border: 1px solid #ffe58f; border-radius: 4px; margin-bottom: 1em;"></div>
    <div class="save-container" style="margin-bottom: 1em;">
        <button id="saveButton" style="display: none;">スプレッドシートに保存</button>
        <span id="saveStatus" style="color: green; font-weight: bold;"></span>
    </div>
    <button type="button" id="printBtn">このページを印刷する</button>
    <div style="margin-top: 1em; padding: 1em; border: 1px solid #f5c6cb; background-color: #f8d7da; border-radius: 8px;">
        <label for="finalizeToggle">大会を終了する:</label>
        <input type="checkbox" id="finalizeToggle">
        <span id="finalizeStatus" style="font-weight: bold;">進行中</span>
    </div>
    <div class="input-section" style="text-align: center; padding: 2em;">
        <button style="padding: 1em 2em; font-size: 1.2em;" onclick="location.href='input.html'">点数入力ページへ</button>
    </div>

    <div class="container">
        <!-- クラス別 総合得点ランキング -->
        <div class="ranking-section">
            <div class="tabs" id="totalRankTabs">
                <button data-class="C" class="active">Cクラス</button>
                <button data-class="B">Bクラス</button>
                <button data-class="A">Aクラス</button>
            </div>
            <div class="table-wrapper">
                <div id="totalRankContent_C" class="tab-content active">
                    <h3>Cクラス 総合得点ランキング</h3>
                    <table id="classC_playersTable">
                        <thead><tr><th>順位</th><th>名前</th><th>組</th><th>合計</th><th>編集</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="totalRankContent_B" class="tab-content">
                    <h3>Bクラス 総合得点ランキング</h3>
                    <table id="classB_playersTable">
                        <thead><tr><th>順位</th><th>名前</th><th>組</th><th>合計</th><th>編集</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="totalRankContent_A" class="tab-content">
                     <h3>Aクラス 総合得点ランキング</h3>
                     <table id="classA_playersTable">
                        <thead><tr><th>順位</th><th>名前</th><th>組</th><th>合計</th><th>編集</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 種目別ランキング -->
        <div class="ranking-section">
            <div class="tabs" id="eventRankTabs">
                <button data-class="C" class="active">Cクラス</button>
                <button data-class="B">Bクラス</button>
                <button data-class="A">Aクラス</button>
            </div>
            <div class="table-wrapper">
                <div id="eventRankContent_C" class="tab-content active">
                    <h3>Cクラス 種目別ランキング</h3>
                    <div data-event="floor"><h4>Cクラス - 床</h4><table id="eventRankContent_C_floor"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="vault"><h4>Cクラス - 跳馬</h4><table id="eventRankContent_C_vault"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="bars"><h4>Cクラス - 段違い平行棒</h4><table id="eventRankContent_C_bars"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="beam"><h4>Cクラス - 平均台</h4><table id="eventRankContent_C_beam"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                </div>
                <div id="eventRankContent_B" class="tab-content">
                    <h3>Bクラス 種目別ランキング</h3>
                    <div data-event="floor"><h4>Bクラス - 床</h4><table id="eventRankContent_B_floor"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="vault"><h4>Bクラス - 跳馬</h4><table id="eventRankContent_B_vault"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="bars"><h4>Bクラス - 段違い平行棒</h4><table id="eventRankContent_B_bars"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="beam"><h4>Bクラス - 平均台</h4><table id="eventRankContent_B_beam"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                </div>
                <div id="eventRankContent_A" class="tab-content">
                    <h3>Aクラス 種目別ランキング</h3>
                    <div data-event="floor"><h4>Aクラス - 床</h4><table id="eventRankContent_A_floor"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="vault"><h4>Aクラス - 跳馬</h4><table id="eventRankContent_A_vault"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="bars"><h4>Aクラス - 段違い平行棒</h4><table id="eventRankContent_A_bars"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                    <div data-event="beam"><h4>Aクラス - 平均台</h4><table id="eventRankContent_A_beam"><thead><tr><th>順位</th><th>名前</th><th>得点</th></tr></thead><tbody></tbody></table></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 印刷専用のコンテンツエリア -->
    <div id="print-container"></div>

    <footer>
        <p>&copy; 2025 Created by KOU</p>
    </footer>

    <!-- CSVヘルプモーダル -->
    <div id="csvHelpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeCsvHelpModal">&times;</span>
            <h2>CSVデータの作り方 (女子用)</h2>
            <p>Excelなどの表計算ソフトで、以下の形式で選手データを作成し、「CSV (カンマ区切り)」形式で保存してください。</p>
            <p><strong>注意:</strong> 1行目は必ずヘッダー（項目名）にしてください。プログラムは2行目からデータを読み込みます。</p>
            <table class="manual-table">
                <thead>
                    <tr>
                        <th>A列</th><th>B列</th><th>C列</th><th>D列</th><th>E列</th><th>F列</th><th>G列</th><th>H列</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>クラス</td><td>組</td><td>(空欄)</td><td>選手名</td><td>床</td><td>跳馬</td><td>段違い</td><td>平均台</td>
                    </tr>
                    <tr>
                        <td>C</td><td>1組</td><td></td><td>体操 花子</td><td>0</td><td>0</td><td>0</td><td>0</td>
                    </tr>
                    <tr>
                        <td>B</td><td>2組</td><td></td><td>日本 桜</td><td>0</td><td>0</td><td>0</td><td>0</td>
                    </tr>
                </tbody>
            </table>
            <h4>ポイント</h4>
            <ul>
                <li><strong>A列 (クラス):</strong> C, B, A のいずれかを入力します。</li>
                <li><strong>B列 (組):</strong> 「1組」「2組」のように入力します。</li>
                <li><strong>C列:</strong> この列は使いませんが、必ず空の列として存在させてください。</li>
                <li><strong>D列 (選手名):</strong> 選手のフルネームを入力します。</li>
                <li><strong>E列〜H列 (得点):</strong> 初期値として 0 を入力しておくと確実です。</li>
            </ul>
            <h4>保存方法</h4>
            <ol>
                <li>Excelのメニューから「ファイル」→「名前を付けて保存」を選択します。</li>
                <li>「ファイルの種類」で「CSV (カンマ区切り) (*.csv)」を選択します。</li>
                <li>「保存」ボタンをクリックします。(警告が表示される場合がありますが、「はい」で進んでください)</li>
            </ol>
        </div>
    </div>

    <!-- サーバーと通信するためのライブラリを読み込み -->
    <!-- ローカルファイルとして開いても動作するように、CDNからライブラリを読み込みます -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <!-- ドラッグ＆ドロップライブラリ -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
